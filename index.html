<div>
	<label for="actName">Account Name:</label><input id="actName" type="text" value="Name">
	<label for="tabIdx">Tab Index:</label><input id="tabIdx" type="number" value="0">
	<button onclick="openPoeWindow()">Get Stash Data</button>
</div>
<div>
	<label for="stashData">Paste Stash Data</label>
	<textarea id="stashData"></textarea>
</div>
<button onclick="parseData()">Find Mods</button>
<div id="modBlock">
</div>
<template id="modRow">
	<div id="modData"></div>
</template>
<script>
	const $ = (q) => document.querySelector(q);
	const template = $("#modRow"),
		modBlock = $("#modBlock");
	
	function openPoeWindow(){
		const act = $("#actName").value,
		tab = $("#tabIdx").value;
		window.open(`https://www.pathofexile.com/character-window/get-stash-items?league=Harvest&tabs=1&accountName=${act}&tabIndex=${tab}`);
	}
	
	const cleanReg = /(\([^\)]*\)|<[^>]*>)/g;
	function parseData(){
		let data = JSON.parse($("#stashData").value);
		let mods = [];
		for (var item of data.items) {
			if (!item.craftedMods) { continue; }
			for(let mod of item.craftedMods) {
				mods.push(mod.replace(cleanReg, ''));	
			}
		}
		mods.sort();
		for (var mod of mods) { appendMod(mod); }
	}
	
	function appendMod(mod){
		let clone = template.content.cloneNode(true);
		let dataNode = clone.querySelector("#modData");
		dataNode.textContent = mod;
		modBlock.appendChild(clone);
	}
</script>
